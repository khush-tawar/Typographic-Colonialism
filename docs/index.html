<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Typographic Colonialism — A Data Investigation</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson@3"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+Thai&family=Noto+Sans+Devanagari&family=Noto+Sans+Bengali&family=Noto+Sans+JP&family=Noto+Sans+Arabic&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Georgia', serif;
      background: #FAFAF8;
      color: #1a1a1a;
      line-height: 1.7;
    }
    
    /* Hero Section */
    .hero {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 60px 20px;
      background: linear-gradient(180deg, #1a1a1a 0%, #2a2a2a 100%);
      color: #fff;
      position: relative;
    }
    
    .hero-overline {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      font-size: 11px;
      letter-spacing: 4px;
      text-transform: uppercase;
      color: #888;
      margin-bottom: 30px;
    }
    
    .hero h1 {
      font-size: clamp(48px, 8vw, 96px);
      font-weight: 400;
      letter-spacing: -2px;
      line-height: 1.1;
      max-width: 900px;
      margin-bottom: 30px;
    }
    
    .hero h1 span {
      color: #C74848;
    }
    
    .hero-subtitle {
      font-size: 20px;
      color: #aaa;
      max-width: 600px;
      margin-bottom: 50px;
      font-style: italic;
    }
    
    .hero-stat {
      display: flex;
      gap: 60px;
      margin-top: 40px;
    }
    
    .hero-stat-item {
      text-align: center;
    }
    
    .hero-stat-number {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      font-size: 48px;
      font-weight: 700;
      color: #fff;
    }
    
    .hero-stat-number.red {
      color: #C74848;
    }
    
    .hero-stat-label {
      font-size: 12px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 5px;
    }
    
    .scroll-indicator {
      position: absolute;
      bottom: 40px;
      font-size: 12px;
      color: #666;
      letter-spacing: 2px;
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(10px); }
    }
    
    /* Section Styles */
    section {
      max-width: 1200px;
      margin: 0 auto;
      padding: 100px 40px;
    }
    
    .section-number {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      font-size: 12px;
      letter-spacing: 3px;
      color: #999;
      margin-bottom: 20px;
    }
    
    .section-title {
      font-size: clamp(32px, 5vw, 48px);
      font-weight: 400;
      margin-bottom: 20px;
      line-height: 1.2;
    }
    
    .section-subtitle {
      font-size: 18px;
      color: #666;
      max-width: 700px;
      margin-bottom: 50px;
    }
    
    .section-intro {
      font-size: 20px;
      line-height: 1.8;
      max-width: 700px;
      margin-bottom: 60px;
    }
    
    .section-intro strong {
      color: #C74848;
    }
    
    /* Visualization Container */
    .viz-container {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 40px rgba(0,0,0,0.08);
      overflow: hidden;
      margin: 40px 0;
    }
    
    .viz-container.dark {
      background: #1a1a1a;
    }
    
    /* Pull Quote */
    .pull-quote {
      border-left: 4px solid #C74848;
      padding: 30px 40px;
      margin: 60px 0;
      background: #f5f5f5;
    }
    
    .pull-quote p {
      font-size: 24px;
      font-style: italic;
      color: #333;
      line-height: 1.5;
    }
    
    .pull-quote cite {
      display: block;
      margin-top: 15px;
      font-size: 14px;
      color: #888;
      font-style: normal;
    }
    
    /* Divider */
    .divider {
      width: 80px;
      height: 3px;
      background: #1a1a1a;
      margin: 80px auto;
    }
    
    /* Full Width Section */
    .full-width {
      max-width: 100%;
      padding: 100px 20px;
      background: #f0f0f0;
    }
    
    .full-width .inner {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    /* Footer */
    footer {
      background: #1a1a1a;
      color: #fff;
      padding: 80px 40px;
    }
    
    footer .inner {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    footer h3 {
      font-family: 'Helvetica Neue', Arial, sans-serif;
      font-size: 12px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: #888;
      margin-bottom: 20px;
    }
    
    footer p {
      color: #aaa;
      font-size: 15px;
      line-height: 1.8;
      margin-bottom: 30px;
      max-width: 600px;
    }
    
    footer a {
      color: #C74848;
      text-decoration: none;
    }
    
    footer a:hover {
      text-decoration: underline;
    }
    
    .source-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }
    
    .source-item {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 6px;
    }
    
    .source-item h4 {
      font-size: 14px;
      color: #fff;
      margin-bottom: 8px;
    }
    
    .source-item p {
      font-size: 12px;
      color: #888;
      margin: 0;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .hero-stat {
        flex-direction: column;
        gap: 30px;
      }
      
      section {
        padding: 60px 20px;
      }
    }
    
    /* Loading State */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 400px;
      color: #888;
      font-size: 14px;
    }
    
    /* Caption */
    .viz-caption {
      text-align: center;
      padding: 20px;
      font-size: 12px;
      color: #888;
      border-top: 1px solid #eee;
      font-family: 'Helvetica Neue', Arial, sans-serif;
    }
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero">
    <div class="hero-overline">A Data Investigation</div>
    <h1>Typographic <span>Colonialism</span></h1>
    <p class="hero-subtitle">
      How digital fonts left 4 billion people behind — and what that reveals about who gets to participate in the typographic web.
    </p>
    <div class="hero-stat">
      <div class="hero-stat-item">
        <div class="hero-stat-number">1,900</div>
        <div class="hero-stat-label">Latin Fonts</div>
      </div>
      <div class="hero-stat-item">
        <div class="hero-stat-number red">32</div>
        <div class="hero-stat-label">Han Fonts (1.6B speakers)</div>
      </div>
      <div class="hero-stat-item">
        <div class="hero-stat-number red">47</div>
        <div class="hero-stat-label">Scripts with zero fonts*</div>
      </div>
    </div>
    <div class="scroll-indicator">↓ SCROLL TO EXPLORE</div>
  </header>

  <!-- SECTION 1: THE DISPARITY -->
  <section id="disparity">
    <div class="section-number">01 — THE DISPARITY</div>
    <h2 class="section-title">You'd need to zoom in 50× to make them equal</h2>
    <p class="section-subtitle">Font availability by script, visualized proportionally</p>
    
    <p class="section-intro">
      If we sized writing systems by how many fonts they have access to, <strong>Latin would be a sun</strong> and everything else would be dust particles orbiting it. This isn't hyperbole—it's mathematics. Latin script has 1,900+ fonts. The median for other scripts is <strong>under 10</strong>.
    </p>
    
    <div class="viz-container" id="viz-wheel">
      <div class="loading">Loading visualization...</div>
    </div>
    <div class="viz-caption">Fig 1. Font Distribution Wheel — Toggle between population and font count to see the disparity</div>
    
    <div class="pull-quote">
      <p>"When your script has 3 fonts and Latin has 1,900, you don't have a font choice problem. You have a visibility problem."</p>
    </div>
  </section>

  <div class="divider"></div>

  <!-- SECTION 2: THE GEOGRAPHY -->
  <section id="geography">
    <div class="section-number">02 — THE GEOGRAPHY</div>
    <h2 class="section-title">The colonial cartography of fonts</h2>
    <p class="section-subtitle">Where fonts flow and where they don't</p>
    
    <p class="section-intro">
      The map below isn't showing income inequality or internet access. It's showing <strong>font availability by region</strong>. Notice anything familiar? The patterns of typographic poverty follow colonial boundaries with disturbing precision. Western Europe: black (1,000+ fonts). Sub-Saharan Africa: red (often <10 fonts per script).
    </p>
    
    <div class="viz-container" id="viz-map">
      <div class="loading">Loading visualization...</div>
    </div>
    <div class="viz-caption">Fig 2. World Script Inequality Map — Hover to explore font availability by country</div>
  </section>

  <div class="divider"></div>

  <!-- SECTION 3: THE TIMELINE -->
  <section id="timeline">
    <div class="section-number">03 — THE TIMELINE</div>
    <h2 class="section-title">A 40-year head start</h2>
    <p class="section-subtitle">When scripts entered the digital age—and who got left behind</p>
    
    <p class="section-intro">
      In 1984, PostScript launched. Latin fonts became digital. <strong>Everyone else waited.</strong> Arabic entered in 1991. Devanagari in 1996. Some scripts didn't arrive until 2016—a 32-year gap that compounded into thousands of missing fonts. Each bubble below represents a writing system, sized by how many people use it. Watch where they land.
    </p>
    
    <div class="viz-container" id="viz-timeline">
      <div class="loading">Loading visualization...</div>
    </div>
    <div class="viz-caption">Fig 3. The Wait vs Web Domination — Bubble size = speaker population, Y-axis = inequality ratio</div>
  </section>

  <div class="divider"></div>

  <!-- SECTION 4: THE RESCUE -->
  <section id="noto">
    <div class="section-number">04 — THE RESCUE</div>
    <h2 class="section-title">Enter Noto: "No more tofu"</h2>
    <p class="section-subtitle">How Google gave 47 scripts their first fonts</p>
    
    <p class="section-intro">
      In 2010, Google launched the Noto project with a mission: eliminate "tofu"—those □ boxes that appear when a font can't render a character. For <strong>47 writing systems</strong>, Noto wasn't just another font option. It was their <em>first</em> option. The ridge chart below shows Noto's coverage across scripts and weights. The peaks are Latin. The valleys are everyone else.
    </p>
    
    <div class="viz-container dark" id="viz-noto">
      <div class="loading" style="color:#666">Loading visualization...</div>
    </div>
    <div class="viz-caption" style="background:#1a1a1a; color:#666; border-top-color:#333">Fig 4. Noto 3D Ridge Chart — Font variant coverage across 150+ scripts</div>
    
    <div class="pull-quote">
      <p>"47 scripts would have zero fonts without Google. That's not a market failure—it's a system that never tried to include them."</p>
    </div>
  </section>

  <div class="divider"></div>

  <!-- SECTION 5: THE VARIABLE DIVIDE -->
  <section id="variable">
    <div class="section-number">05 — THE ONGOING DIVIDE</div>
    <h2 class="section-title">Even Noto isn't equal</h2>
    <p class="section-subtitle">Try it yourself: drag the slider</p>
    
    <p class="section-intro">
      Variable fonts are the cutting edge of typography—smooth transitions between weights, precision control for designers. Of 543 variable fonts in Google Fonts, <strong>almost all support only Latin</strong>. Drag the slider below. Watch Latin text flow smoothly from Thin to Black. Watch everything else snap between just two weights. This isn't a bug. It's a feature—for some.
    </p>
    
    <div class="viz-container" id="viz-variable">
      <div class="loading">Loading visualization...</div>
    </div>
    <div class="viz-caption">Fig 5. The Variable Font Divide — Drag to experience typographic inequality firsthand</div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="inner">
      <h3>About This Project</h3>
      <p>
        This investigation began with a simple question: <em>Why do some languages look beautiful on the web while others render as boxes?</em> The answer led through 400 years of printing history, colonial trade routes, and the economics of font creation. The data told a story we couldn't ignore.
      </p>
      <p>
        All visualizations were built using D3.js and designed with participatory principles—because the best way to understand inequality is to experience it.
      </p>
      
      <h3>Data Sources</h3>
      <div class="source-list">
        <div class="source-item">
          <h4>Google Fonts API</h4>
          <p>1,916 fonts with script/weight metadata</p>
        </div>
        <div class="source-item">
          <h4>Unicode CLDR</h4>
          <p>Language-script-territory mappings</p>
        </div>
        <div class="source-item">
          <h4>ISO 15924</h4>
          <p>234 script codes and classifications</p>
        </div>
        <div class="source-item">
          <h4>Wikidata</h4>
          <p>Speaker population estimates</p>
        </div>
      </div>
      
      <h3>Dataset</h3>
      <p>
        The complete dataset is available on GitHub:<br>
        <a href="https://github.com/khush-tawar/Typographic-Colonialism/tree/dataset" target="_blank">github.com/khush-tawar/Typographic-Colonialism</a>
      </p>
      
      <p style="margin-top:60px; font-size:12px; color:#555;">
        * Without Google's Noto project<br>
        © 2024 Khush Tawar — Data visualization for digital justice
      </p>
    </div>
  </footer>

  <script>
    // ═══════════════════════════════════════════════════════════════════════════
    // LOAD DATA
    // ═══════════════════════════════════════════════════════════════════════════
    const DATA_URL = "https://raw.githubusercontent.com/khush-tawar/Typographic-Colonialism/dataset/data/processed/master_dataset.json";
    const WORLD_URL = "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json";
    
    let masterData = null;
    let worldGeo = null;
    
    async function loadData() {
      try {
        console.log("Loading data...");
        const [dataRes, worldRes] = await Promise.all([
          fetch(DATA_URL).then(r => r.json()),
          fetch(WORLD_URL).then(r => r.json())
        ]);
        masterData = dataRes;
        worldGeo = topojson.feature(worldRes, worldRes.objects.countries);
        console.log("Data loaded successfully", { scripts: Object.keys(masterData.scripts || {}).length });
        
        // Initialize all visualizations
        renderFontWheel();
        console.log("Font wheel rendered");
        renderWorldMap();
        console.log("World map rendered");
        renderTimeline();
        console.log("Timeline rendered");
        renderNotoRidge();
        console.log("Noto ridge rendered");
        renderVariableDivide();
        console.log("Variable divide rendered");
      } catch (error) {
        console.error("Error loading data:", error);
        document.body.innerHTML += `<div style="position:fixed;top:0;left:0;right:0;background:#C74848;color:#fff;padding:20px;z-index:9999;">
          <strong>Error loading visualizations:</strong> ${error.message}
        </div>`;
      }
    }
    
    loadData();
    
    // ═══════════════════════════════════════════════════════════════════════════
    // VIZ 1: FONT DISTRIBUTION WHEEL
    // ═══════════════════════════════════════════════════════════════════════════
    function renderFontWheel() {
      const container = document.getElementById('viz-wheel');
      container.innerHTML = '';
      
      const scripts = masterData.scripts || {};
      const latinFonts = scripts.Latn?.font_count || 1900;
      
      // Get top 15 scripts by font count (excluding Latin)
      const otherScripts = Object.entries(scripts)
        .filter(([code, s]) => code !== 'Latn' && s.font_count > 0)
        .sort((a, b) => b[1].font_count - a[1].font_count)
        .slice(0, 15);
      
      const width = 1100;
      const height = 700;
      
      const wrapper = d3.select(container)
        .append("div")
        .style("padding", "40px");
      
      // Header
      const header = wrapper.append("div")
        .style("text-align", "center")
        .style("margin-bottom", "40px");
      
      header.append("div")
        .style("font-family", "'Helvetica Neue', Arial, sans-serif")
        .style("font-size", "28px")
        .style("font-weight", "700")
        .style("letter-spacing", "3px")
        .style("margin-bottom", "10px")
        .text("FONT AVAILABILITY BY SCRIPT");
      
      header.append("div")
        .style("font-size", "15px")
        .style("color", "#666")
        .html("Latin compared to the 15 next largest scripts");
      
      // Chart area
      const chartDiv = wrapper.append("div")
        .style("display", "flex")
        .style("align-items", "center")
        .style("justify-content", "center")
        .style("gap", "80px");
      
      // Latin circle
      const latinSection = chartDiv.append("div")
        .style("text-align", "center");
      
      const latinSize = 300;
      latinSection.append("div")
        .style("width", `${latinSize}px`)
        .style("height", `${latinSize}px`)
        .style("background", "#1a1a1a")
        .style("border-radius", "50%")
        .style("display", "flex")
        .style("flex-direction", "column")
        .style("align-items", "center")
        .style("justify-content", "center")
        .style("color", "#fff")
        .html(`
          <div style="font-size:48px; font-weight:700;">${latinFonts.toLocaleString()}</div>
          <div style="font-size:14px; color:#888; margin-top:5px;">LATIN</div>
        `);
      
      // Other scripts
      const othersSection = chartDiv.append("div");
      
      othersSection.append("div")
        .style("font-family", "'Helvetica Neue', Arial, sans-serif")
        .style("font-size", "12px")
        .style("color", "#888")
        .style("margin-bottom", "20px")
        .style("text-transform", "uppercase")
        .style("letter-spacing", "2px")
        .text("Everyone Else");
      
      const grid = othersSection.append("div")
        .style("display", "grid")
        .style("grid-template-columns", "repeat(5, 1fr)")
        .style("gap", "15px");
      
      otherScripts.forEach(([code, s]) => {
        const size = Math.max(20, Math.sqrt(s.font_count / latinFonts) * latinSize);
        
        const cell = grid.append("div")
          .style("text-align", "center");
        
        cell.append("div")
          .style("width", `${Math.max(size, 30)}px`)
          .style("height", `${Math.max(size, 30)}px`)
          .style("background", s.font_count < 30 ? "#C74848" : "#666")
          .style("border-radius", "50%")
          .style("margin", "0 auto 8px")
          .style("display", "flex")
          .style("align-items", "center")
          .style("justify-content", "center")
          .style("color", "#fff")
          .style("font-size", size > 40 ? "14px" : "10px")
          .style("font-weight", "600")
          .text(s.font_count);
        
        cell.append("div")
          .style("font-size", "10px")
          .style("color", "#888")
          .text(s.name || code);
      });
      
      // Insight
      wrapper.append("div")
        .style("background", "#fff3cd")
        .style("border-left", "4px solid #ffc107")
        .style("padding", "20px")
        .style("margin-top", "40px")
        .style("font-size", "14px")
        .style("color", "#533f03")
        .html(`<strong>The scale problem:</strong> If Latin's circle represents 1,900 fonts, most other scripts' circles should be invisible at this zoom level. The average non-Latin script has just ${Math.round(otherScripts.reduce((s, [_, d]) => s + d.font_count, 0) / otherScripts.length)} fonts.`);
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // VIZ 2: WORLD MAP
    // ═══════════════════════════════════════════════════════════════════════════
    function renderWorldMap() {
      const container = document.getElementById('viz-map');
      container.innerHTML = '';
      
      const scripts = masterData.scripts || {};
      const countryToScript = new Map();
      
      Object.entries(scripts).forEach(([code, s]) => {
        (s.countries || []).forEach(country => {
          const existing = countryToScript.get(country);
          if (!existing || s.font_count > existing.fontCount) {
            countryToScript.set(country, {
              scriptCode: code,
              scriptName: s.name,
              fontCount: s.font_count || 0
            });
          }
        });
      });
      
      const countryIdMap = {
        "4": "AF", "8": "AL", "12": "DZ", "24": "AO", "32": "AR", "36": "AU", "40": "AT",
        "50": "BD", "56": "BE", "68": "BO", "76": "BR", "100": "BG", "104": "MM", "116": "KH",
        "120": "CM", "124": "CA", "140": "CF", "144": "LK", "148": "TD", "152": "CL", "156": "CN",
        "170": "CO", "178": "CG", "180": "CD", "188": "CR", "191": "HR", "192": "CU", "196": "CY",
        "203": "CZ", "204": "BJ", "208": "DK", "214": "DO", "218": "EC", "818": "EG", "222": "SV",
        "231": "ET", "232": "ER", "233": "EE", "246": "FI", "250": "FR", "266": "GA", "268": "GE",
        "276": "DE", "288": "GH", "300": "GR", "320": "GT", "324": "GN", "328": "GY", "332": "HT",
        "340": "HN", "348": "HU", "352": "IS", "356": "IN", "360": "ID", "364": "IR", "368": "IQ",
        "372": "IE", "376": "IL", "380": "IT", "384": "CI", "388": "JM", "392": "JP", "398": "KZ",
        "400": "JO", "404": "KE", "408": "KP", "410": "KR", "414": "KW", "417": "KG", "418": "LA",
        "422": "LB", "426": "LS", "430": "LR", "434": "LY", "440": "LT", "442": "LU", "450": "MG",
        "454": "MW", "458": "MY", "462": "MV", "466": "ML", "478": "MR", "484": "MX", "496": "MN",
        "498": "MD", "504": "MA", "508": "MZ", "512": "OM", "516": "NA", "524": "NP", "528": "NL",
        "554": "NZ", "558": "NI", "562": "NE", "566": "NG", "578": "NO", "586": "PK", "591": "PA",
        "598": "PG", "600": "PY", "604": "PE", "608": "PH", "616": "PL", "620": "PT", "634": "QA",
        "642": "RO", "643": "RU", "646": "RW", "682": "SA", "686": "SN", "688": "RS", "694": "SL",
        "702": "SG", "703": "SK", "704": "VN", "705": "SI", "706": "SO", "710": "ZA", "716": "ZW",
        "724": "ES", "728": "SS", "729": "SD", "740": "SR", "748": "SZ", "752": "SE", "756": "CH",
        "760": "SY", "762": "TJ", "764": "TH", "768": "TG", "780": "TT", "784": "AE", "788": "TN",
        "792": "TR", "795": "TM", "800": "UG", "804": "UA", "807": "MK", "826": "GB", "834": "TZ",
        "840": "US", "854": "BF", "858": "UY", "860": "UZ", "862": "VE", "887": "YE", "894": "ZM",
        "51": "AM", "31": "AZ", "48": "BH", "64": "BT", "70": "BA", "72": "BW", "96": "BN",
        "108": "BI", "270": "GM", "275": "PS", "499": "ME", "158": "TW"
      };
      
      const getColor = fontCount => {
        if (fontCount >= 500) return "#1a1a1a";
        if (fontCount >= 100) return "#444";
        if (fontCount >= 30) return "#888";
        if (fontCount >= 10) return "#bbb";
        if (fontCount >= 1) return "#C74848";
        return "#e8e8e8";
      };
      
      const width = 1100;
      const height = 600;
      
      const wrapper = d3.select(container);
      
      // Header
      const header = wrapper.append("div")
        .style("text-align", "center")
        .style("padding", "40px 40px 20px");
      
      header.append("div")
        .style("font-family", "'Helvetica Neue', Arial, sans-serif")
        .style("font-size", "28px")
        .style("font-weight", "700")
        .style("letter-spacing", "3px")
        .text("WORLD SCRIPT INEQUALITY");
      
      header.append("div")
        .style("font-size", "15px")
        .style("color", "#666")
        .style("margin-top", "10px")
        .html("Darker = more fonts. <span style='color:#C74848'>Red = critical (<10 fonts)</span>");
      
      // SVG
      const svg = wrapper.append("svg")
        .attr("viewBox", [0, 0, width, height])
        .style("width", "100%")
        .style("display", "block");
      
      const projection = d3.geoNaturalEarth1()
        .fitSize([width - 40, height - 40], worldGeo)
        .translate([width / 2, height / 2]);
      
      const path = d3.geoPath(projection);
      
      // Tooltip
      const tooltip = wrapper.append("div")
        .style("position", "absolute")
        .style("background", "#1a1a1a")
        .style("color", "#fff")
        .style("padding", "15px")
        .style("border-radius", "4px")
        .style("font-size", "13px")
        .style("pointer-events", "none")
        .style("opacity", 0)
        .style("z-index", 1000);
      
      svg.selectAll("path")
        .data(worldGeo.features)
        .join("path")
        .attr("d", path)
        .attr("fill", d => {
          const iso2 = countryIdMap[d.id];
          const data = countryToScript.get(iso2);
          return data ? getColor(data.fontCount) : "#e8e8e8";
        })
        .attr("stroke", "#fff")
        .attr("stroke-width", 0.5)
        .style("cursor", "pointer")
        .on("mouseenter", function(event, d) {
          const iso2 = countryIdMap[d.id];
          const data = countryToScript.get(iso2);
          
          d3.select(this).attr("stroke", "#1a1a1a").attr("stroke-width", 2);
          
          if (data) {
            tooltip.html(`
              <div style="font-weight:700; margin-bottom:5px;">${d.properties?.name || iso2}</div>
              <div>Script: ${data.scriptName}</div>
              <div>Fonts: <strong>${data.fontCount}</strong></div>
            `);
          } else {
            tooltip.html(`<div style="font-weight:700;">${d.properties?.name || 'Unknown'}</div>`);
          }
          
          tooltip.style("opacity", 1);
        })
        .on("mousemove", function(event) {
          tooltip
            .style("left", (event.pageX + 15) + "px")
            .style("top", (event.pageY - 10) + "px");
        })
        .on("mouseleave", function() {
          d3.select(this).attr("stroke", "#fff").attr("stroke-width", 0.5);
          tooltip.style("opacity", 0);
        });
      
      // Legend
      const legend = wrapper.append("div")
        .style("display", "flex")
        .style("justify-content", "center")
        .style("gap", "25px")
        .style("padding", "20px")
        .style("flex-wrap", "wrap");
      
      [
        { color: "#1a1a1a", label: "Dominant (500+)" },
        { color: "#444", label: "Privileged (100-499)" },
        { color: "#888", label: "Struggling (30-99)" },
        { color: "#bbb", label: "Neglected (10-29)" },
        { color: "#C74848", label: "Critical (<10)" }
      ].forEach(item => {
        const leg = legend.append("div").style("display", "flex").style("align-items", "center").style("gap", "8px");
        leg.append("div").style("width", "16px").style("height", "16px").style("background", item.color).style("border-radius", "3px");
        leg.append("div").style("font-size", "12px").style("color", "#666").text(item.label);
      });
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // VIZ 3: TIMELINE BUBBLE CHART
    // ═══════════════════════════════════════════════════════════════════════════
    function renderTimeline() {
      const container = document.getElementById('viz-timeline');
      container.innerHTML = '';
      
      const scripts = masterData.scripts || {};
      const inequality = new Map((masterData.inequality_metrics || []).map(d => [d.code, d]));
      
      const nodes = Object.entries(scripts)
        .filter(([_, d]) => d.font_count > 0)
        .map(([code, d]) => {
          const ineq = inequality.get(code) || {};
          const digitalStart = d.digital_age_start || 2010;
          return {
            code,
            name: d.name || code,
            digitalStart,
            inequalityRatio: ineq.inequality_ratio || 1,
            speakers: d.speakers || 0,
            fontCount: d.font_count || 0
          };
        });
      
      const width = 1100;
      const height = 700;
      const margin = { top: 60, right: 150, bottom: 80, left: 80 };
      const innerW = width - margin.left - margin.right;
      const innerH = height - margin.top - margin.bottom;
      
      const xScale = d3.scaleLinear().domain([1982, 2022]).range([0, innerW]);
      const yScale = d3.scaleLog().domain([0.5, 120]).range([innerH, 0]).clamp(true);
      const sizeScale = d3.scaleSqrt().domain([0, 2e9]).range([4, 60]);
      
      const getColor = d => {
        if (d.code === "Latn") return "#2A9D8F";
        if (d.inequalityRatio < 2) return "#4CAF50";
        if (d.inequalityRatio < 10) return "#FF9800";
        return "#C74848";
      };
      
      const wrapper = d3.select(container);
      
      // Header
      const header = wrapper.append("div")
        .style("text-align", "center")
        .style("padding", "40px 40px 20px");
      
      header.append("div")
        .style("font-family", "'Helvetica Neue', Arial, sans-serif")
        .style("font-size", "28px")
        .style("font-weight", "700")
        .style("letter-spacing", "3px")
        .text("THE WAIT VS WEB DOMINATION");
      
      header.append("div")
        .style("font-size", "15px")
        .style("color", "#666")
        .style("margin-top", "10px")
        .text("Each bubble is a script. Size = speakers. Position = when it went digital × inequality.");
      
      const svg = wrapper.append("svg")
        .attr("viewBox", [0, 0, width, height])
        .style("width", "100%")
        .style("display", "block")
        .style("background", "#FAFAF8");
      
      const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
      
      // Zones
      const zones = [
        { y0: 0.5, y1: 2, color: "#4CAF50", label: "Parity" },
        { y0: 2, y1: 10, color: "#FF9800", label: "Underserved" },
        { y0: 10, y1: 120, color: "#C74848", label: "Font Poverty" }
      ];
      
      zones.forEach(z => {
        g.append("rect")
          .attr("x", 0).attr("width", innerW)
          .attr("y", yScale(z.y1))
          .attr("height", yScale(z.y0) - yScale(z.y1))
          .attr("fill", z.color).attr("opacity", 0.08);
        
        g.append("text")
          .attr("x", innerW + 10).attr("y", (yScale(z.y0) + yScale(z.y1)) / 2)
          .attr("fill", z.color).attr("font-size", "11px").attr("font-weight", "600")
          .text(z.label);
      });
      
      // X axis
      [1984, 1991, 2000, 2010, 2020].forEach(year => {
        const x = xScale(year);
        g.append("line").attr("x1", x).attr("x2", x).attr("y1", 0).attr("y2", innerH)
          .attr("stroke", "#ddd").attr("stroke-dasharray", year === 1984 ? "none" : "4,4");
        g.append("text").attr("x", x).attr("y", innerH + 20).attr("text-anchor", "middle")
          .attr("fill", "#888").attr("font-size", "11px").text(year);
      });
      
      // Y axis
      [1, 2, 5, 10, 25, 50, 100].forEach(tick => {
        g.append("line").attr("x1", 0).attr("x2", innerW).attr("y1", yScale(tick)).attr("y2", yScale(tick))
          .attr("stroke", "#eee").attr("stroke-dasharray", "2,4");
        g.append("text").attr("x", -10).attr("y", yScale(tick) + 4).attr("text-anchor", "end")
          .attr("fill", "#888").attr("font-size", "10px").text(tick === 1 ? "Equal" : `${tick}×`);
      });
      
      // Nodes
      const sortedNodes = [...nodes].sort((a, b) => a.speakers - b.speakers);
      
      g.selectAll("circle")
        .data(sortedNodes)
        .join("circle")
        .attr("cx", d => xScale(d.digitalStart))
        .attr("cy", d => yScale(d.inequalityRatio))
        .attr("r", d => d.code === "Latn" ? 50 : sizeScale(d.speakers))
        .attr("fill", getColor)
        .attr("fill-opacity", 0.7)
        .attr("stroke", getColor)
        .attr("stroke-width", 1.5);
      
      // Labels for key scripts
      const keyScripts = ["Latn", "Arab", "Hans", "Deva", "Beng", "Cyrl"];
      nodes.filter(n => keyScripts.includes(n.code)).forEach(n => {
        g.append("text")
          .attr("x", xScale(n.digitalStart))
          .attr("y", yScale(n.inequalityRatio) - (n.code === "Latn" ? 60 : sizeScale(n.speakers) + 10))
          .attr("text-anchor", "middle")
          .attr("fill", "#333")
          .attr("font-size", n.code === "Latn" ? "14px" : "11px")
          .attr("font-weight", n.code === "Latn" ? "700" : "500")
          .text(n.name);
      });
      
      // Axis labels
      svg.append("text")
        .attr("x", margin.left + innerW / 2).attr("y", height - 20)
        .attr("text-anchor", "middle").attr("fill", "#666").attr("font-size", "12px")
        .text("YEAR SCRIPT ENTERED DIGITAL AGE →");
      
      svg.append("text")
        .attr("transform", `translate(20, ${margin.top + innerH / 2}) rotate(-90)`)
        .attr("text-anchor", "middle").attr("fill", "#666").attr("font-size", "12px")
        .text("← FONT INEQUALITY (× worse than Latin)");
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // VIZ 4: NOTO RIDGE (Simplified version)
    // ═══════════════════════════════════════════════════════════════════════════
    function renderNotoRidge() {
      const container = document.getElementById('viz-noto');
      container.innerHTML = '';
      
      const fonts = masterData.fonts || [];
      const scripts = masterData.scripts || {};
      
      // Get Noto fonts by target script
      const notoFonts = fonts.filter(f => f.is_noto === true && f.noto_target_script);
      const fontsByScript = {};
      notoFonts.forEach(f => {
        const code = f.noto_target_script;
        if (!fontsByScript[code]) fontsByScript[code] = [];
        fontsByScript[code].push(f);
      });
      
      // Calculate coverage per script
      const allWeights = ["100", "200", "300", "400", "500", "600", "700", "800", "900"];
      const scriptData = Object.entries(fontsByScript)
        .map(([code, fonts]) => {
          const weightCounts = allWeights.map(w => 
            fonts.filter(f => f.weights?.includes(w)).length
          );
          return {
            code,
            name: scripts[code]?.name || code,
            fonts: fonts.length,
            weights: weightCounts,
            total: weightCounts.reduce((a, b) => a + b, 0)
          };
        })
        .sort((a, b) => b.total - a.total)
        .slice(0, 30);
      
      const wrapper = d3.select(container)
        .style("background", "#1a1a1a")
        .style("padding", "40px");
      
      // Header
      const header = wrapper.append("div")
        .style("text-align", "center")
        .style("margin-bottom", "40px");
      
      header.append("div")
        .style("font-family", "'Helvetica Neue', Arial, sans-serif")
        .style("font-size", "28px")
        .style("font-weight", "700")
        .style("letter-spacing", "3px")
        .style("color", "#fff")
        .text("NOTO FONT COVERAGE");
      
      header.append("div")
        .style("font-size", "15px")
        .style("color", "#888")
        .style("margin-top", "10px")
        .text(`${notoFonts.length} font families across ${Object.keys(fontsByScript).length} scripts`);
      
      // Stats row
      const stats = wrapper.append("div")
        .style("display", "flex")
        .style("justify-content", "center")
        .style("gap", "60px")
        .style("margin-bottom", "40px");
      
      [
        { value: Object.keys(fontsByScript).length, label: "Scripts Covered" },
        { value: notoFonts.length, label: "Font Families" },
        { value: "47", label: "Rescued Scripts", highlight: true }
      ].forEach(s => {
        const stat = stats.append("div").style("text-align", "center");
        stat.append("div")
          .style("font-size", "48px")
          .style("font-weight", "700")
          .style("color", s.highlight ? "#9c27b0" : "#fff")
          .text(s.value);
        stat.append("div")
          .style("font-size", "11px")
          .style("color", "#888")
          .style("text-transform", "uppercase")
          .style("letter-spacing", "1px")
          .text(s.label);
      });
      
      // Bar chart
      const width = 1000;
      const height = 500;
      const margin = { top: 30, right: 30, bottom: 100, left: 150 };
      
      const svg = wrapper.append("svg")
        .attr("viewBox", [0, 0, width, height])
        .style("width", "100%")
        .style("display", "block");
      
      const yScale = d3.scaleBand()
        .domain(scriptData.map(d => d.name))
        .range([margin.top, height - margin.bottom])
        .padding(0.3);
      
      const xScale = d3.scaleLinear()
        .domain([0, d3.max(scriptData, d => d.total)])
        .range([margin.left, width - margin.right]);
      
      // Bars
      svg.selectAll("rect")
        .data(scriptData)
        .join("rect")
        .attr("x", margin.left)
        .attr("y", d => yScale(d.name))
        .attr("width", d => xScale(d.total) - margin.left)
        .attr("height", yScale.bandwidth())
        .attr("fill", (d, i) => i === 0 ? "#2A9D8F" : d.total < 5 ? "#9c27b0" : "#666")
        .attr("rx", 2);
      
      // Labels
      svg.selectAll(".label")
        .data(scriptData)
        .join("text")
        .attr("x", margin.left - 10)
        .attr("y", d => yScale(d.name) + yScale.bandwidth() / 2 + 4)
        .attr("text-anchor", "end")
        .attr("fill", "#888")
        .attr("font-size", "11px")
        .text(d => d.name);
      
      // Values
      svg.selectAll(".value")
        .data(scriptData)
        .join("text")
        .attr("x", d => xScale(d.total) + 8)
        .attr("y", d => yScale(d.name) + yScale.bandwidth() / 2 + 4)
        .attr("fill", "#666")
        .attr("font-size", "10px")
        .text(d => d.total);
    }
    
    // ═══════════════════════════════════════════════════════════════════════════
    // VIZ 5: VARIABLE FONT DIVIDE
    // ═══════════════════════════════════════════════════════════════════════════
    function renderVariableDivide() {
      const container = document.getElementById('viz-variable');
      container.innerHTML = '';
      
      const wrapper = d3.select(container)
        .style("padding", "0");
      
      // Header
      const header = wrapper.append("div")
        .style("text-align", "center")
        .style("padding", "50px 40px 30px");
      
      header.append("div")
        .style("font-family", "'Helvetica Neue', Arial, sans-serif")
        .style("font-size", "28px")
        .style("font-weight", "700")
        .style("letter-spacing", "3px")
        .style("margin-bottom", "12px")
        .text("THE VARIABLE FONT DIVIDE");
      
      header.append("div")
        .style("width", "120px")
        .style("height", "3px")
        .style("background", "#1a1a1a")
        .style("margin", "0 auto 20px");
      
      header.append("div")
        .style("font-size", "15px")
        .style("color", "#666")
        .style("max-width", "600px")
        .style("margin", "0 auto")
        .html("Drag the weight slider. Watch Latin text <strong>flow</strong>. Watch everything else <strong>snap</strong>.");
      
      // Slider section
      const sliderSection = wrapper.append("div")
        .style("background", "#1a1a1a")
        .style("padding", "35px 60px")
        .style("margin", "20px 0");
      
      const sliderRow = sliderSection.append("div")
        .style("display", "flex")
        .style("align-items", "center")
        .style("gap", "30px")
        .style("max-width", "800px")
        .style("margin", "0 auto");
      
      sliderRow.append("div")
        .style("font-size", "11px")
        .style("color", "#888")
        .style("text-transform", "uppercase")
        .style("letter-spacing", "2px")
        .text("Font Weight");
      
      const slider = sliderRow.append("input")
        .attr("type", "range")
        .attr("min", "100")
        .attr("max", "900")
        .attr("value", "400")
        .style("flex", "1")
        .style("height", "8px")
        .style("cursor", "pointer");
      
      const weightDisplay = sliderRow.append("div")
        .style("font-size", "36px")
        .style("font-weight", "700")
        .style("color", "#fff")
        .style("font-family", "monospace")
        .style("min-width", "80px")
        .style("text-align", "right")
        .text("400");
      
      // Comparison grid
      const comparisons = [
        { script: "Latin", font: "Inter", family: "'Inter', sans-serif", text: "Typography shapes how we read the world", isVariable: true },
        { script: "Thai", font: "Noto Sans Thai", family: "'Noto Sans Thai', sans-serif", text: "การออกแบบตัวอักษรกำหนดวิธีที่เราอ่านโลก", isVariable: false },
        { script: "Hindi", font: "Noto Sans Devanagari", family: "'Noto Sans Devanagari', sans-serif", text: "टाइपोग्राफी हमारे पढ़ने के तरीके को आकार देती है", isVariable: false },
        { script: "Bengali", font: "Noto Sans Bengali", family: "'Noto Sans Bengali', sans-serif", text: "টাইপোগ্রাফি আমাদের পড়ার ধরন নির্ধারণ করে", isVariable: false },
        { script: "Japanese", font: "Noto Sans JP", family: "'Noto Sans JP', sans-serif", text: "タイポグラフィは私たちの読み方を形作る", isVariable: false },
        { script: "Arabic", font: "Noto Sans Arabic", family: "'Noto Sans Arabic', sans-serif", text: "الطباعة تشكل طريقة قراءتنا للعالم", isVariable: false, rtl: true }
      ];
      
      const grid = wrapper.append("div").style("padding", "40px 60px");
      
      const rows = [];
      comparisons.forEach((comp, idx) => {
        const row = grid.append("div")
          .style("display", "grid")
          .style("grid-template-columns", "100px 1fr")
          .style("gap", "30px")
          .style("padding", "35px 0")
          .style("border-bottom", idx < comparisons.length - 1 ? "1px solid #e5e5e5" : "none")
          .style("align-items", "center");
        
        const labelCol = row.append("div");
        labelCol.append("div")
          .style("font-size", "13px")
          .style("font-weight", "700")
          .style("color", comp.isVariable ? "#16a34a" : "#1a1a1a")
          .text(comp.script);
        labelCol.append("div")
          .style("font-size", "10px")
          .style("color", comp.isVariable ? "#16a34a" : "#999")
          .style("font-style", "italic")
          .text(comp.isVariable ? "smooth transition" : "snaps between weights");
        
        const textCol = row.append("div");
        const textSample = textCol.append("div")
          .attr("class", `sample-${idx}`)
          .style("font-family", comp.family)
          .style("font-size", "38px")
          .style("font-weight", "400")
          .style("color", "#1a1a1a")
          .style("line-height", "1.4")
          .style("transition", comp.isVariable ? "font-weight 0.05s ease" : "none")
          .style("direction", comp.rtl ? "rtl" : "ltr")
          .text(comp.text);
        
        textCol.append("div")
          .style("font-size", "10px")
          .style("color", "#bbb")
          .style("margin-top", "8px")
          .text(comp.font);
        
        rows.push({ element: textSample, isVariable: comp.isVariable });
      });
      
      // Insight box
      const insight = wrapper.append("div")
        .style("background", "#fff3cd")
        .style("border-left", "4px solid #ffc107")
        .style("margin", "20px 60px 40px")
        .style("padding", "25px 30px");
      
      insight.append("div")
        .style("font-size", "13px")
        .style("font-weight", "700")
        .style("color", "#856404")
        .style("margin-bottom", "10px")
        .style("text-transform", "uppercase")
        .style("letter-spacing", "1px")
        .text("What You're Seeing");
      
      insight.append("div")
        .style("font-size", "14px")
        .style("color", "#533f03")
        .style("line-height", "1.7")
        .html(`As you drag the slider, <strong>Latin (Inter)</strong> smoothly transitions through every weight value — 100, 237, 489, 712 — each renders uniquely. <strong>Every other script snaps</strong> between fixed points (usually 400 and 700), ignoring everything in between. This isn't a technical limitation — it's a choice about who gets precision typography.`);
      
      // Slider event
      slider.on("input", function() {
        const weight = +this.value;
        weightDisplay.text(weight);
        rows.forEach(row => {
          row.element.style("font-weight", weight);
        });
      });
    }
  </script>
</body>
</html>
